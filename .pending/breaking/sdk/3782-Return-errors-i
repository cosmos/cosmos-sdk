#3782 Return errors instead of panic
