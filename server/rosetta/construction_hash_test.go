package rosetta

import (
	"context"
	"testing"

	"github.com/coinbase/rosetta-sdk-go/types"
	"github.com/stretchr/testify/require"

	cosmos "github.com/cosmos/cosmos-sdk/server/rosetta/client/sdk"
	"github.com/cosmos/cosmos-sdk/server/rosetta/client/tendermint"
)

func TestLaunchpad_ConstructionHash(t *testing.T) {
	expectedHash := "FD2EE60A7FC7D91B348F11D73A8556AED46A05D1F18D842D63D9E74650A9EF19"

	properties := properties{
		Blockchain: "TheBlockchain",
		Network:    "TheNetwork",
		AddrPrefix: "cosmos",
	}
	adapter := newAdapter(cosmos.NewClient(""), tendermint.NewClient(""), properties)

	resp, err2 := adapter.ConstructionHash(context.Background(), &types.ConstructionHashRequest{
		SignedTransaction: "7b2274797065223a22636f736d6f732d73646b2f5374645478222c2276616c7565223a7b226d7367223a5b7b2274797065223a22636f736d6f732d73646b2f4d736753656e64222c2276616c7565223a7b2266726f6d5f61646472657373223a22636f736d6f7331726c76397a7a7939356b36777632723867376c71706373753668727863706e363835716c6a70222c22746f5f61646472657373223a22636f736d6f73316466766d79367a3566676837387a333968346a357563356768307668713774646a6a757a716d222c22616d6f756e74223a5b7b2264656e6f6d223a22746f6b656e222c22616d6f756e74223a223130227d5d7d7d5d2c22666565223a7b22616d6f756e74223a5b5d2c22676173223a22323030303030227d2c227369676e617475726573223a5b7b227075625f6b6579223a7b2274797065223a2274656e6465726d696e742f5075624b6579536563703235366b31222c2276616c7565223a224167316333736e563058436f316742656269565158454938643930554d656c764b554149344d74626a566c46227d2c227369676e6174757265223a224274724f4b376a7632733330552f4130745456496a58722f7043305239726c6a724d4f56504c646642574e58444e626a5767714e367666344a696b6a634566493354774a39495569386f4c5667705a5a364c334b4b413d3d227d5d2c226d656d6f223a22544f444f206d656d6f227d7d",
	})

	require.Nil(t, err2)
	require.Equal(t, expectedHash, resp.TransactionIdentifier.Hash)
}
